								介質訪問控制子層



	網絡大致可以分爲兩大類:點到點連接和廣播信道。

---------------------------------------------------------------------------------------------------------------


	點到點鏈路通信時只有兩個對象，源端與目標端。但是廣播信道中則有許多個不同的通信實體在使用網絡，
此時需要一種可以控制它們對這些信道的訪問控制機制，以此保證不會出現衝突。

	廣播信道有時候稱爲多路訪問信道(multiacess channel)或隨機訪問信道(random access channel)。
	用來確定多路訪問信道下一個使用者的協議屬於數據鏈路層的一個子層，該層稱爲介質訪問控制子層(MAC,
Medium Access Control)子層。在LAN中，MAC子層尤爲重要，特別是WLAN中。

---------------------------------------------------------------------------------------------------------------

信道分配問題:

--------靜態信道分配:

		多個競爭用戶之間分配單個信道的傳統做法是把信道容量拆分開給多個用戶使用。例如，FDM,OFDM。但是一般
	流量呈突發性，於是FDM將會造成某些頻譜中頻段的浪費。
		靜態FDM的性能通過一個排隊理論計算可以很容易得出:

			一個信道容量爲C bps，在這個信道上發送一幀需要平均延遲T。假設幀的平均到達率爲x幀/秒，幀長度
		可變，平均值爲每幀1/k位。於是可以計算出信道的服務率爲kC幀/秒。

				T=1/(kC-x)

			假設C爲100Mbps，平均幀長1/k位等於10000位，幀的到達率x爲5000幀/秒，則T=200微秒。但是這種情
		況是只有單個用戶，沒有引入排隊延遲的時間。

			若將C劃分爲N和獨立的子信道，每個子信道的容量爲C/N bps。則每個子信道的平均到達率爲x/N，於是T
		爲:

				T_N=1/(k(C/N)-(x/N))=N/(kC-x)=NT

			如果所有幀引入隊列，那麼劃分信道後單個信道的平均延遲比不分的情況差N倍。於是可以得知，靜態
		信道分配不適合突發流量。

--------動態信道分配假設:

		動態信道分配有5個關鍵假設:

			1>流量獨立；
			2>單信道；
			3>衝突可觀察；
			4>時間連續或分槽；
			5>載波偵聽與不聽；

			---------------

			流量獨立:假設有N個獨立的站，每個站都有數據幀要傳送。在長度爲t的間隔內，期望產生的幀數是t*n，
			n爲常數(新幀到達率)。一旦生成一幀，該站阻塞，直到幀被傳送出去。

			單信道:所有站都是用這一個信道進行通信。信道是雙工的。

			衝突可觀察:如果兩個站同時傳輸，則它們的幀在時間上就重疊，由此產生的信號是混亂的，這種情況稱爲
			衝突(collision)。所有站都能監測到衝突，且衝突幀需要稍後重傳。

			時間連續或分槽:一種方式是時間連續，所有站都可以在任意時間訪問信道；另一種方式是將時間劃分成
			離散的時間槽。幀從時間槽的起點開始傳輸，一個時間槽內可能包含0，1或多個幀，分別對應於空閒時間槽，
			一次成功發送，或者一次衝突。

			載波偵聽與不聽:所有站都可以在試圖使用信道前就能直到該信道是否正被使用。如果信道忙，則不嘗試去
			訪問信道。如果不偵聽信道，那麼所有站都會隨機發送數據幀，再判斷傳輸是否成功(確認幀)。

			然而載波偵聽在物理設備，有線信道上可以輕鬆實現；但是在無線鏈路上則很難做到。於是無線鏈路上的介質
		訪問控制不同於有線信道(以太網絡)上的協議。另外沒有多路訪問協議能夠保證可靠傳送，即使沒有衝突發生也有可能
		發生意料之外的錯誤。於是，要由鏈路層的其他部分或更高層次來提供數據傳輸的可靠性。

---------------------------------------------------------------------------------------------------------------

多路訪問協議:

	多路訪問協議，目的是爲了控制用戶端之間的信道訪問衝突。根據工作方式可以分爲無衝突系統與競爭系統，訪問限制
分爲時間連續任意訪問或者時間分槽循環。

		基本協議有:

				1>純ALOHA；
				2>分槽ALOHA；
				3>載波偵聽多路訪問協議--|
							|-CSMA--|
								|-非堅持CSMA；
								|-堅持CSMA；
								|-p-堅持CSMA； 
								|-CSMA/CD；
								|-CSMA/CA；
				4>無競爭協議----|
						|-位圖協議；
						|-令牌傳遞；
						|-二進制倒計數；
						|-有限競爭協議；
						|-自適應樹遍歷協議；
				5>適用於802.11的協議----|
							|-MACA；

		-----------

		純ALOHA:

			基本思想是:當用戶有數據需要傳輸時就訪問信道。
			
			這樣做將會有大概率導致衝突，衝突幀將被丟棄，然後發送方等待一段隨機時間後重傳。

			純ALOHA的效率:

				用幀時(frame time)表示傳輸一個標準的，固定長度的幀所需時間(幀的長度/比特率)。
			假設所有站在平均每"幀時產生N個幀的泊鬆分佈。如果N>1，則用戶羣生成幀的速率大於信道處理
			速度，因此每個幀都將受衝突。於是爲了取得合理的吞吐量，應期望0<N<1。除了新幀外，老幀在
			衝突後需要被重傳；假設老幀與新幀合起來也符合泊松分佈，則每幀時的平均幀數爲G。G>=N，
			在低負載時衝突很少發生。
				吞吐量S是負載G乘以成功傳輸的概率P0--S=GP0。因爲站在傳輸是不幀聽載波，假設有幀1
			在將要到達接收方時，有一站發送了一個新幀2；幀2將會與幀1衝突，於是在超時後兩個站將重傳。
				在給定的一個"幀時"內希望有G幀，但生成k幀的概率服從泊松分佈:

						Pr[k]=(G^k * e^-G)/k!

				於是生成0幀的概率爲e^-G。在兩個"幀時"長的間隔中，生成幀的平均數是2G。因此在整個
			易受衝突期中，不發送幀的概率是P0=e^-2G。利用S=GP0,則有:

						S=G*e^-2G

				最大的吞吐量出現在G=0.5時，S=1/2e，約等於0.184。於是信道的利用率最好爲18%。

		-----------

		分槽ALOHA:
		
			這個方式與純ALOHA不同的是，它將連續的時間分成了若干個離散的時間槽。每個站只有在自己的時間
		槽來臨時纔可以傳輸數據幀。

			分槽ALOHA的效率:

				測試，測試幀所在的同一個時間槽中沒有其他流量的概率時e^-G，則有:

						S=G*e^-G

				當G=1，S=1/e，約等於0.368。於是分槽ALOHA的最好利用率爲:

					37%->空時間槽；
					37%->成功傳輸；
					26%->衝突；

				測試，假設測試幀能夠避免一次衝突的概率是e^-G，即其他用戶在該時間槽內靜止。於是衝突
			概率爲1-e^-G。若需要k次嘗試才能成功，則成功傳輸的概率爲:

						P_k=e^-G * (1-e^-G)^(k-1)

						P_k爲一個序列；

					則每幀傳輸次數期望 E 爲:

						E=e^G

				E隨G呈指數增長的結果是，信道負載的微小增長也會極大地降低信道地性能。

		-----------

		堅持CSMA:

			在一個協議中，站能夠監聽信道狀態並採取相應地行動，則這樣的協議被稱爲載波幀聽協議(carrier 
		sense protocol)。
			
			堅持CSMA，1-堅持載波檢測多路訪問(CSMA,Carrier Sence Multiple Access)。
			當一個站有數據要發送，就先偵聽信道。偵聽時長:
				假設單向傳輸一個幀的爲t，那麼當幀1發送，接收方接收到後返回確認；那麼幀時爲2t。

			堅持CSMA的工作方式是:當它要傳輸數據時，先偵聽信道。若信道空閒，則發送數據；若信道忙，它就等待
		知道信道爲空閒後再發送數據。如果傳輸中有衝突產生，就等待一段隨機時間後，再重新開始前面的步驟來重傳衝突
		幀。

		-----------

		非堅持CSMA:
		
			非堅持CSMA(nonpersistent CSMA)，它的工作方式同堅持CSMA基本一致。唯一不同之處是，當偵聽到信道忙
		的時候，該協議不持續監聽信道；而是在等待一段隨機的時間後再重新開始前面的步驟。因此該算法有好的信道利用率，
		但是也引入了延遲開銷。

		-----------

		p-堅持CSMA:

			該協議適用於時間分槽的信道。其工作方式是:當一個站要發送數據，它先偵聽信道。若信道空閒，則按照概率
		p發送數據幀；而以概率q=1-p將此次發送推遲到下一個時間槽。重複這個過程直到數據被成功發送出去。

		-----------

		CSMA/CD:

			帶衝突檢測的CSMA(CSMA/CD,CSMA with Collision Detection)。它是經典以太網的基礎。
			CSMA/CD同樣也是用在時間分槽的信道上，當幀準備好後，，它需要先監聽信道，確保信道上沒有出現衝突。
		然後，該站將傳輸數據幀。如果有衝突，就中止傳輸，並等待一段隨機時間後再次嘗試。
			監聽信道的時間的長度則應設置爲2t，t爲單向信號傳播的延遲；2t保證一個幀成功傳輸。而且，若幀在接收方
		產生了衝突，衝突信號也需要t時間才能返回。
			CSMA/CD也可以看成是分槽ALOHA，但區別是CSMA/CD在一個時間槽中只能有一個站可以傳輸。
			於是CSMA/CD系統將交替出現競爭期，傳輸期，以及所有站都靜止的空閒期。

		-----------

		位圖協議:

			CSMA/CD雖然可以檢測衝突，但是還是有衝突發生，而衝突將會浪費帶寬。因此有一些可以做的無衝突的協議。
		
			位圖協議，採用了基本位圖法(basic bitmap method)。基本思想是:在每個競爭期內正好有N個時間槽。如果
		0號站要發送數據，它就在0號槽中傳輸1位。在0號槽不允許其他站發送。在N個槽的競爭期結束後，所有的站都地知道
		其他哪些站希望傳輸數據；之後便按照時間槽順序，各個站在時間槽到來後傳輸自己的數據幀。
			像這樣在時間發送數據前先廣播自己有發送數據意圖的協議，被稱爲預留協議(reservation protocol)。
			雖然位圖協議可以無衝突傳輸，但是它也給低位編號的站引入了比高位編號的站更多的延遲。

			假設數據幀由d個時間單位構成。在數據幀少時，位圖循環快。但是如果時間槽在N/2時，0號站有數據需要
		傳輸，此時，0號的時間槽已經經過。它必須要等待下一次位圖到來時纔可以廣播自己的意圖，而等到實際可以傳輸幀，
		則需要等待第二次N個時間槽經過。於是它的排隊延遲是 N/2+N=1.5N。
			而高位編號的站，只需要等待半個掃描週期(N/2)後就可以傳送數據。
			假若編號位N的站需要傳輸數據，此時經過了N/2個時間槽，它可以再等待N/2的時間槽後，廣播自己的意圖。之
		後就可以等待傳輸數據幀了。所以高位編號的站平均排隊延遲是 N/2=0.5N。

			在高負載情況，所有站都要傳輸；於是N位競爭期被分攤到N個幀上，因此每一幀的額外開銷只有1位，即信道
		利用率爲d/(d+1)。一幀的平均延遲爲 站內排隊時間+它到達傳輸隊列隊首之後另外的(N-1)/d+N的時間。

		-----------

		令牌傳遞:

			令牌傳遞也如同位圖協議，讓所有站以預定義的順序輪流發送一幀。令牌傳遞中，令牌表示發送權限。如果
		有站需要傳輸幀，它將等待令牌到來；在得到令牌後發送一幀，之後將令牌傳遞給下一個站。於是一般令牌傳遞也稱爲
		令牌環(token ring)協議。
			在令牌環協議中，網絡拓撲結構被用來定義站的發送順序。所有站連接成單環結構，令牌在這個環中被循環傳遞。
		爲了阻止幀陷入無線循環，在它到達一個目標站或者最初發送的原始站後，將要被取下來。
			令牌環協議基本相同於位圖協議，但是消除了低位編號站與高位編號站之間的排隊平衡問題。因爲在單環結構中，
		每一個站都需要等待令牌的到來。

		-----------

		二進制倒計數:

			二進制倒計數協議可以消除位圖協議中的每個站的1位開銷。它的工作方式是:

				如果一個站想要使用信道，它就以二進制位串的形式廣播自己的地址，從高序的位開始。假定所有
			站的地址長度一致，不同站的地址中相同位在同時發送時被信道布爾或(BOOLEAN OR)在一起。爲了避免衝突，
			必須使用一條仲裁規則:一個站只要看到自己的地址位中0值位置被改寫爲1，則它必須放棄競爭。而接下來的
			0值的站將繼續競爭信道。

			站在競爭時期傳輸的地址，並非一次性傳輸所有，而是從高至低一次一位。
			例如

			站1	0101
			站2	0110
			站3	1001

			之間競爭

			t=1,	0 | 0 | 1 =1，於是第一時間，1與2發現值被改變，於是退出競爭。

			這種方法的信道利用率爲d/(d+log2(N))。而且，如果精心設計幀格式，使得發送方的地址正好是幀內第一個
		字段，那麼甚至log2(N)位也不會被浪費，所以信道利用率爲100%。

		-----------

		有限競爭協議:

			有限競爭協議，它將競爭協議與無衝突協議的優勢結合了起來。這樣可以使得在低負載下採用競爭的做法而
		提供較短的延遲，但在高負載下採用無衝突技術，從而獲得良好的信道效率。
			在有限競爭協議之前的其他協議都是對稱工作的，即每個站都有p的概率意圖使用信道。如果協議可以爲不同
		的站分配不同的概率p，則有時系統的整體性能會有所提高。

			有限競爭協議的思路是:將站按分組，然後爲不同的分組分配一個時間槽；之後組內成員就競爭這一個時間槽，
		以此獲得信道來傳輸數據幀。
			首先，極端的情形:
				每個組只包含了一個站。這樣的分配方案可以保證永遠不會發生衝突，因爲一個時間槽最多一個站。
			另一個情形:
				每個組兩個站。在一個時間槽中，兩個站都要傳輸數據的概率是p^2。

			隨着一個組內的站的數量增加，衝突概率也隨之增加，但是給予各站競爭機會所需的位圖掃描長度卻縮小了。
		有限的情況是每個組包含全部的站(即分槽ALOHA)。

			而有限競爭協議需要的是一種動態地將站分配到時間槽的方法，當負載很低時，每個時間槽中的站點數量就
		多一些；當負載很高時，每個時間槽中的站點數量就少一些，甚至只有一個站。

		-----------

		自適應樹遍歷協議:

			自適應樹遍歷協議提供了一種簡單地分配必要的信道的方法。

			自適應數遍歷協議的基本思路是:

				將站看作是二叉樹的葉節點。在一次成功傳送之後的第一個競爭槽0號槽(時間槽)中，允許所有的站來嘗試
			訪問信道。如果沒有衝突，則直接使用；如果衝突了，就將1號槽(0號槽之後)的時間槽設置爲樹中2號節點之下的站
			才能參入競爭。
				站是被視作葉節點，接在樹節點之下。
				如果2號節點下的站沒有衝突，則在獲得信道的站點完成傳輸後，
			1號時間槽將被保留給3號節點下的站使用。如果在1號時間槽產生了衝突，則將2號時間槽分配給4號節點下的站使用。

			示例圖:



								1
						2				3
					4		5		6		7
					A,B		C,D		E,F		G,H


				二叉樹的基本事實是，第i層上的節點最大數量是是2^i。第i層上的每個節點是其下面總站數的2^-i。

				q爲每個站對全部就緒站的數目估算良好值。
				如果q個就緒站均勻分佈，則在第i層上某一特定節點下面期望的就緒站是2^-i * q。那麼可以得知
				
							i=log2(q)

				於是就可以得到樹中就緒站的數量。
				
				且因爲二叉樹可以折半搜索，於是可以快速的確定站對信道的訪問順序。

		-----------

		MACA:

			衝突避免多路訪問(MACA,Multiple Access with Collision Avoidance)。這個協議是爲無線局域網設計的介質訪問控制
		協議。

			在WLAN中，衝突一般都是發生在接收方，而非發送方。而且如果讓發送方使用CSMA來控制訪問，則會因爲各個節點的
		信號輻射範圍有限，無法得知其他站的狀體。

			#表示該站正在傳輸。假設使用CSMA。			

			隱藏終端問題(hidden station problem):

			
				A#	B	C#	D
				
			此時A的信號範圍內只有B，A如果偵聽載波將會得知A->B是可用的；但是此時C也要向B發送數據，C也會偵聽載波，得知
		C->B是可用的。於是A與C都向B發送數據幀，那麼它們的幀將會在接收端B處產生衝突。

			由於競爭者離得太遠而無法檢測到潛在的競爭者，隱藏終端問題。

			
			暴露終端問題(exposed station problem):

				A	B#	C	D

			此時B在向A傳送數據，但如果同一時間C意圖向D傳送數據。那麼首先C會偵聽信道，因爲B在傳輸，於是C會錯誤的得知
		C->D不可用。於是C則會等待B傳輸完成後重新偵聽信道。

			由於在信號範圍內由某個終端在向其他的目標傳輸數據，從而錯誤的認爲本終端不可對不同於正在傳輸中目標終端之外的其他
		傳輸終端發送數據。暴露終端問題。

			於是可以得知CSMA不適用於WLAN中，因此需要WLAN專用的協議；MACA。

			MACA的基本思路是:發送方刺激接收方廣播一個短幀，來通知附近的站，它即將開始傳輸數據。其他站在收到這個短幀
		後，將不會向這個廣播終端傳輸數據，直到廣播終端的數據傳輸完成。

			於是MACA中，發送方向接收方發送一個RTS(Request To Send)幀，以此表明自己希望向對方傳輸數據。RTS幀在被對應的
		終端接收到後，接收方終端將會廣播一個CTS(Clear to Send)幀作爲應答。來暫時靜默附近的其他終端對自己發送數據。發送方在
		收到CTS之後就開始數據傳輸了。
			RTS幀30字節，其中包含了數據長度，CTS中也包含了複製自RTS中的數據長度。其他暫時靜默的終端可以從其中的信息來
		推算出傳輸將可能持續的時長。
			
			這種情況也會有衝突，即RTS幀衝突。如果發送方在超時時間內沒有收到CTS應答，將會在等待一段隨機時間後重傳RTS幀。
				
---------------------------------------------------------------------------------------------------------------

以太網--|
	|-經典以太網
	|-交換式以太網



---------------------------

		-----------

		經典以太網:

			施樂以太網(Xerox Ethernet)。1976年，由Metcalfe與Boggs設計出第一個以太網，它們將該網絡系統
		命名爲以太網(Ethernet)。

			DIX標準(DIX standard)，由DEC，英特爾，施樂公司在1978年制定的一個10Mbps以太網標準。

			網絡拓撲:

				使用電纜連接整個局域網計算機，每2.5米處由一個標記，用來指示連接計算機的位置。俗稱
			粗以太網。
				它的前任是細以太網，電纜比粗以太網更柔軟，更易於彎曲，且使用了工業標準BNC接頭。但是
			它單段電纜長度只有185米，粗以太網是500米。細以太網每段電纜只能處理30臺計算機。

			限制:

				經典以太網的每個版本都有線路長度限制，長度範圍內的信號可以正常傳播。於是在需要建設
			更大的網絡時需要使用中繼器(類似於集線器)來接收，放大，轉發信號。網絡中可以有多個電纜段與
			中繼器，但是兩個收發器之間最大距離爲2.5千米，且中間的中繼器不可以超過4個。

			-----------

			經典以太網MAC子層協議:

				經典以太網的幀格式:

				
				bytes	8	6		6	2	0-1500		0-46	4
					前導碼	目標地址	源地址	類型	數據		填充	校驗和

								DIX標準

				bytes	0-------7-8	6		6	2	0-1500	0-46	4
					前導碼	SOF	目標地址	源地址	Length	Data	填充	校驗和

								802.3標準

				前導碼:8字節，每個字節包含比特模式 10101010(最後一個字節的最後2位爲11)，它是802.3的
				幀起始定界符(Start Of Frame,SOF)。比特模式使用曼切斯特編碼產生的10MHz方波，每個波
				6.4微秒，方便同步。最後兩個"1"告知接收方即將開始一個幀。

				目標地址與源地址:如果地址的第一位是0，則表示這是一個普通地址；如果是1，則表示是個
				組地址。組地址允許多個站同時監聽一個地址。組地址發送行爲稱爲組播(multicasting)。
				由全1組成的特殊地址保留作爲廣播(broadcasting)地址。
					源地址設置:
						源地址具有全球唯一性。該地址由IEEE統一分配，前三個字節用作該站所在
					組的組織唯一標示符(OUI,Organizationally Unique Identifier)。後三字段由NIC
					製造商負責分配，空間大小爲2^24，需保證不重複。

				類型/長度:使用哪個字段取決於該幀是DIX幀還是802.3幀。類型字段告知接收方幀內包含了什麼；
				IEEE指示長度字段包含幀的長度，但如此違反了分層規定。於是這個問題由另一個包含在數據包內的
				邏輯鏈路控制(LLC,Logical Link Control)協議頭來處理，它使用8個字節來傳達2個字節的協議類型。
				但是這個規定無法兼容DIX標準的NIC；於是現在的規定是:
					任何值小於或等於0x600(1536)可解釋爲長度字段，任何大於0x600可解釋爲類型字段。

				數據:最多可包含1500個字節。但規定以太網有效幀必須至少64個字節長，從目標地址算起直到校驗和，
				包括這兩個字段在內。當幀不夠64字節時，將會啓用填充。限制最小長度的另一個原因是，避免出現當
				一個短幀還沒有到達電纜遠端的發送方，該幀的傳送就已經結束；但是在電纜的遠端，該幀可能與另一
				幀發生衝突。因爲傳播延遲雙向是2t，但是如果傳輸短幀，則會在衝突信號回到發送方之前就傳輸結束；
				從而會導致發送方任何上一幀已經成功傳送。
		
				填充:在幀長度不夠64時填充幀。
				
				校驗和:採用的時32位CRC，用來提供檢錯功能，如果檢測到一個錯誤，將丟棄該幀。

			-----------

			二進制指數後退的CSMA/CA:

				CSMA/CA(CSMA with Collision Avoidance)，帶有衝突避免的CSMA。
				
				二進制指數後退CSMA/CA的具體工作方式:衝突次數設置爲i，在偵聽到衝突時，i=1，則每個站
			隨機等待0或1個時間槽之後再重試。i=2，則每個站隨機選擇0，1，2，3；然後等待這個選擇次數的時間
			槽後，再重試。於是隨機選擇範圍是: 0~~~2^i - 1。
				再達到了10次衝突時，即i=10；那麼隨機數選擇區間被固定在最大值1023且後續不再增加。當
			i=16，控制器將放棄這次傳輸並返回失敗報告。錯誤恢復工作由高層協議完成。

				二進制指數後退CSMA/CA可以確保兩種情況:
						如果只有少量站衝突，則可確保較低延遲；
						如果有大量站衝突，則可以保證在一個相對合理的時間間隔內解決衝突；

			-----------

			以太網性能:

				假定每個時間槽中重傳概率是一個常數。若每個站在競爭一個時間槽中的傳送幀的概率爲p，則
			某個站可以獲得信道的概率爲A。A爲:

					A=kp(1-p)^(k-1)

				當p=1/k，A最大；當k->無限，A->1/e。
				競爭間隔等於j個時間槽的概率爲 A(1-A)^(j-1)。
				於是每次競爭的平均時間槽數量爲 1/A。

				每個時間槽的間隔時間爲2t(傳播延遲時間長度)，因此平均競爭間隔w=2t/A。假定最優p，且競爭
			時間槽的平均數永遠不超過e，則w最多爲 2te 大約等於 5.4t。

				如果傳送一幀需要P秒，則當大量站需要傳輸時，信道效率爲:

					信道效率=P/(P+2t/A)

				從而也可以得知距離會影響性能。

				在每個幀e個競爭時間槽的最優情形下，按照幀長度F，網絡帶寬B，電纜長度L，信號傳播c；則
			上面的等式可以寫爲:

					信道效率=1/(1+2BLe/cF)

				從而可以得知在分母中第二項增大時，網絡效率將會降低。特別是在F確定時，增加網絡帶寬或
				距離(BL乘積)將會降低網絡效率。


			-----------

			交換式以太網:

				最開始的經典以太網使用的是集線器來組織網絡，但是集線器不能增加容量，因爲它們邏輯上等同
			於單根電纜的經典以太網。隨着電纜上的用戶增加，每個用戶獲得固定容量共享份額下降，終將飽和。

				交換式以太網，這中系統的核心是一個交換機(switch),它包含一塊連接所有斷口的高速背板。它工
			作在數據鏈路層。它有多個入境端口與出境端口，在通信時只需要將入境幀轉發到合適的出境端口即可。這種
			網絡拓撲時星型拓撲，以交換機爲中心，當交換機故障，則該LAN中的網絡將處於癱瘓狀態。

				在集線器中所有站都處於一個衝突域，它們必須使用CSMA/CD來調度訪問權限。而在交換機中，每個
			端口都有一個獨立的衝突域，且電纜全雙工；這種情況下將不需要CSMA/CD，只是引入一個特定端口的排隊延遲，
			即有多個端口需要訪問一個出境端口。於是交換機擁有內存，用來來緩衝轉發幀。如果電纜時半雙工，那麼還
			是需要CSMA/CD來競爭訪問。

				混雜模式:大部分LAN接口支持這個模式，在混雜模式(promiscuous mode)下，所有的幀將被廣播。

				-----------

				快速以太網:

					802.3u，802.3標準的補充，快速以太網標準(802.3u)。

					經典802.3的最大速率是10Mbps，而在更新802.3u之後，網絡速度被提升至100Mbps。

					802.3u的基本思想:保留原來的幀格式，接口和過程規則，只是將比特時間從100納秒降低到
					10納秒；同時它還可以兼容10Mbps的經典以太網。

					802.3u的介質選擇:

						經典以太網使用的是3類UTP，但是它不可以在100米長的距離上承載100Mbps的信號。
						3類UTP方案名稱爲100Base-T4，使用了25MHz的信令速度，比經典以太網的20MHz快
						25%

					名稱		線纜		距離		優點

					100Base-T4	雙絞線		100米		可用3類UTP

					100Base-TX	雙絞線		100米		全雙工速率100Mbps(5類UTP)

					100Base-FX	光纖		2000米		全雙工速率100Mbps，距離長

						
						現在一般局域網都選擇5類UTP，它可以處理125MHz的時鐘速率，採用4B/5B編碼，4個
					數據位編碼至5比特以125MHz速率傳輸，最大帶寬是100MHz。

					802.3u標準提供了自動協商(autonegotiation)機制，於是NIC之間可以自動選擇傳輸速率和雙工
					模式。例如10Mbps的以太網卡與100Mbps的以太網卡之間通信，可以協商將速率降低至10Mbps。
					但是這個機制需要雙方都啓用自動協商功能並設置全雙工模式。

				-----------

				千兆以太網:

					802.3ab，千兆以太網(gigabit Ethernet)。

					802.3ab支持全雙工與半雙工。使用交換機則是全雙工模式，此時不需要CSMA/CD；當使用集線器
				時則是半雙工模式，需要使用標準CSMA/CD，因爲帶塊增加了將導致最大的線纜長度下降100倍，即最大長度
				25米，這樣才能維持以太網的本質特性。它支持:10Mbps 100Mbps 1000Mbps 的速率。

					802.3ab增加了兩個特性，以此來解除25米長度的限制:

						1>載波擴充(carrier extension)；
							讓硬件在普通幀後增加填充位，將幀的長度擴充到512字節。填充的添加由硬件
						單獨完成。

						2>幀突發(frame bursting)；
							允許發送方將多個待發送幀級連在一起，一次性傳輸出去。如果突發長度仍小於
						512字節，則進行填充。

					802.3ab的介質選擇:

					名稱		線纜		距離		優點

					1000Base-SX	光纖		550米		多模光纖(50,62.5微米)
	
					1000Base-LX	光纖		5000米		單模光纖(10微米)或多模光纖(50,62.5微米)

					1000Base-CX	2對STP		25米		屏蔽雙絞線

					1000Base-T	2對UTP		100米		標準5類UTP


					當在5類UTP802.3ab時，4對雙絞線需要全部用上。每根線上，5個電壓級別攜帶2比特，信號速率爲125M
				波特。

					802.3ab引入巨型幀(Jumbo frame)擴展，允許幀的長度超過1500字節，通常高達9KB。專有擴展，沒有
				得到標準認可。

				-----------

				萬兆以太網:

					802.3ae，萬兆以太網(10 gigabit Ethernet)。速度快於原先的以太網1000倍。所有的802.3ae只
				支持全雙工模式，CSMA/CD不再時標準設計的一部分，標準的重點在於以超高速率運行的物理層細節。同時
				也保留了兼容性。

					802.3ae的編碼選擇是64B/66B線性編碼。先繞碼數據位，再進行64B/66B線性編碼。

					802.3ae的介質選擇:

					名稱		線纜		距離		優點

					10GBase-SR	光纖		max=300米	多模光纖(0.85微米)

					10GBase-LR	光纖		10千米		單模光纖(1.3微米)
					
					10GBase-ER	光纖		40千米		單模光纖(1.5微米)

					10GBase-CX4	4對雙軸		15米		雙軸銅纜

					10GBase-T	4對UTP		100米		6a類UTP

				
					802.3ae常被用於數據中心和交換局內部；用來連接高端路由器，交換機和服務器，還能用作
				端局之間的長度高帶寬中繼線。

---------------------------------------------------------------------------------------------------------------

無線局域網，802.11:

		IEEE 無線局域網標準 802.11 - 2007

	-----------

	802.11體系結構和協議棧:

		802.11的網絡拓撲:
				
				..
		
				P1#			P4#		..

				P2#			#AP------------------

				P3#			P5#		..
			
				..		
	
					有架構網絡		

				------------------------------------------------------------				


					P8#
				P10#		P9#

					P7#

					自組織網絡

				自組織網絡終端與終端相連，互相通信。

		-----------

			AP:接入點(AP,Access Point)；終端通過與它關聯來傳輸數據幀，AP與其他網絡連接。幾個接入點可通過
			一個稱爲分佈式系統(distribution system)的有線網絡連接在一起。

		-----------

		802.11 協議棧結構:

						上層

						邏輯鏈路層	|
								|-數據鏈路層
						MAC子層		|
						
					802.11	802.11a	802.11b	802.11g	802.11n		|
					|	|	|	|	|		|-物理層
					跳頻和	OFDM	擴頻	OFDM	MIMO		|
					紅外線				OFDM		|
	

			所有的802協議的數據鏈路層分爲兩個或多個子層。在802.11中，介質訪問控制(MAC,Medium Access Control)
		子層決定如何分配信道。在它之上的是邏輯鏈路控制(LLC,Logical Link Control)子層，它的工作是隱藏802系列協議
		之間的差異。

			OFDM:正交頻分複用；

			802.11:最初的版本，使用紅外線與2.4GHz跳頻技術；
			802.11a:使用OFDM技術，工作在5GHz的頻段，但是信號範圍要小於2.4GHz；提供54Mbps的帶寬。
			802.11b:在2.4GHz頻段的1或2Mbps直接序列擴頻被擴展爲運行速率高達11Mbps。
			802.11g:也是用OFDM技術，工作在2.4GHz頻段，提供54Mbps的帶寬。
			802.11n:收發器使用多根天線以此來提高速度，使用OFDM與MIMO(多入多出)技術；多天線提供了更寬的信道。

		-----------

		802.11物理層:

			所有802.11技術都使用短程無線電傳輸信號，工作在2.4GHz或5GHz頻段，這些頻段屬於ISM。所有的傳輸方法
		都定義了多個速率，這種設計可以根據不同情況提供不同的速率。例如無線信號較弱，則用低速率；如果信號清晰，則
		使用高速率。這種速率調整方式稱爲速率自適應(rate adptation)。

			802.11b物理層:

				使用擴展頻譜的方法，支持1，2，5.5，11 Mbps的速率。一般實際總運行在11Mbps。複用技術類似
			CDMA但是所有終端共享一個碼片序列。擴展頻譜是爲了滿足FCC的要求，將信號能量擴展到ISM頻譜。
				802.11b使用的擴展序列是巴克序列(Barker sequence)。

				巴克序列:自相關性很低(除非序列完全一致)，允許接收器鎖定一個傳輸的開始。
				
				若速率爲1Mbps，使用巴克序列與BPSK調製技術，每11個碼片發送1比特。碼片速率11M碼片/秒。
				若速率爲2Mbps，使用巴克序列與QPSK調製技術，每11個碼片2個比特。
				再往上的速率使用補碼鍵控(CCK,Complementary Code Keying)技術編碼。

			802.11a物理層:

				頻段爲5GHz，速率最高54Mbps。採用OFDM效率更高且可以抵抗多徑衰減。比特在52個並行的子載波上
			發送，48個子載波攜帶數據和4個子載波用於同步控制。每個符號持續4微秒，可發送1，2，4，6個比特。比特
			使用二進制卷積碼進行糾錯編碼，因此只有1/2，2/3，3/4比特沒有冗餘。

				5GHz頻段上干擾少，但是覆蓋範圍小於2.4GHz頻段。802.11a的範圍比802.11b的範圍小7倍多。

			802.11b物理層:

				複製了802.11a的OFDM工作在2.4GHz頻段內，且提供同802.11a相同的速率，以及可以與802.11b兼容。
			於是爲了避免不同選擇產生的混淆，一般無線網卡都同時支持802.1a/b/g。

			802.11n物理層:

				它的目標是去掉所有無線開銷後，吞吐量至少達到100Mbps。這個目標要求速率至少增加4倍，於是需
			要擴展信道；於是IEEE把20MHz擴展到40MHz，並且允許幀突發。
				802.11n支持在同一時間內使用4根天線發送4個信息流，信號在接收端會相互干擾，但是可以使用多入
			多出(MIMO,Multiple Input Multiple Output)通信技術將它們分離。
		
		-----------

		802.11MAC子層協議:

			802.11試圖避免衝突，採用了帶有衝突避免的CSMA(CSMA/CA,CSMA with Collision Avoidance)協議。

			CSMA/CA的工作方式:

				概念類似以太網的CSMA/CD，但是發送終端必須以隨機後退開始(除非它最近未使用過信道且信道空閒)，
			並且不等待衝突的發生。在OFDM物理層狀態下後退時間槽選擇範圍是0--15。
				具體做法:通過偵聽確定在一個很短時間內(DIFS時間)沒有信號，就開始倒計數空閒時間槽，當有幀在
			發送時暫停計數器；當計數器遞減到0時該終端發送自己的數據幀。幀傳輸成功，則對方會立即返回一個短確認；
			如果沒有收到確認，則認爲傳輸錯誤，於是需要加倍選擇時間槽數量再進行倒計數重傳。

				這種方式與以太網相比有兩個主要區別:

					1>早期的後退有助於避免衝突；
					2>使用確認來推斷是否發生衝突，因爲無法進行載波信號偵聽；

				這種操作方式稱爲分佈式協調功能(DCF,Distributed Coordination Function)，各個終端獨立執行，沒
			有中央控制機制。除此之外還有個可選模式:點協調功能(PCF,Point Coordination Function)；這種模式下需要
			AP來控制自身覆蓋範圍內的一切活動。

				然而802.11結構下，還是會存在隱藏終端與暴露終端問題，於是802.11定義信道偵聽包括了物理偵聽和
			虛擬偵聽兩部分。
			
				物理偵聽:簡單地檢查介質，檢測是否存在有效信號；
				虛擬偵聽:每個終端保留一個信道何時要被使用地邏輯記錄，這是通跟蹤網絡分配向量(NAV,Network 
				Allocation vector)獲得的。每個幀攜帶一個NAV字段，說明這個幀所屬地一系列數據的傳輸時長。
	
				可選的RTS/CTS機制也是用NAV來防止隱藏終端在同一時間發送。但是RTS/CTS無法解決暴露終端問題。

				-----------

				成功傳輸概率改善:

					1>降低傳輸速率，在給定信噪比下，降低速率可以使用更健壯的調製解調技術；
					2>發送短幀；

					如果任何一位出錯概率爲p，則n位長的幀被成功接收概率時1-p。減少幀長度可以有效降低p，從而
				可以提高成功傳輸的概率。

					短幀通過降低來自網絡層消息的最大尺寸來實現，並且802.11允許將幀拆分成段(fragment)，每個
				段也有自己的校驗和。標準沒有固定段大小，而是保留選擇與AP協商。段獨立編號，使用停-等式協議。

				-----------

				節省電源:

					因爲802.11的終端一般都是移動終端，於是需要省電方案。基本機制是建立在信標幀的基礎上。

					信標幀:由AP定期廣播，該幀通告AP的存在以及傳遞系統參數；例如AP標示，時間，安全設置。

					終端可以在發送給AP的幀中設置一個電源管理位(power-management)來告訴AP自己將進入省電模式(
				power-save mode)。之後AP將會緩衝需要發送給該終端的流量，在每次信標幀到來時終端將被動喚醒並檢查
				信標幀中的流量圖，以此判斷是否有要接收的緩衝流量。如果有則終端發送poll消息給AP來請求緩衝的流量，
				之後可以再進入省電模式直到下一次信標幀到來。

					另一個機制是自動省電交付(APSD,Automatic Power Save Delivery)。2005年時被添加到802.11。
					這個機制下AP依然爲終端緩衝流量，但是終端不再被信標幀喚醒。而是在終端主動向AP發送幀後，
				AP才將緩衝的流量發送給終端。

				-----------

				服務質量:

					802.11使用一個巧妙的機制來提供服務質量，該機制作爲擴展在2005年被引入，標準命名爲802.11e。
					802.11e擴展了CSMA/CA且仔細定義幀之間的各種時間間隔。

					802.11e定義了5個時間間隔:

							1>DCF幀間隔(DIFS,DCF InterFrame Spacing)；所有終端都可以在信道空閒DCF
							時間後嘗試訪問信道，採用通常競爭規則，若衝突	需要二進制指數後退。

							2>SIFS短幀時間間隔(SIFS,Short InterFrame Spacing)；它允許一次對話中的
							各方都具有優先機會使用信道。發送方需要等待SIFS時間間隔後發送下一段。

							3&4>AIFS仲裁幀間空間(AIFS,Arbitration InterFrame Space)；用來設置兩個優先
							級別，有兩個間隔時間。短間隔AIFS1小於DIFS，大於SIFS；被AP用來把語音或其
							他高優先流量移至行頭。AIFS4比DIFS大，用來發送可以延遲到常規流量之後發送
							的背景流量。完善的服務質量機制定義了四種不同的優先級，分別具有不同的後
							退參數與不同的空閒參數。

							5>EIFS擴展幀間隔(EIFS,Extended InterFrame Spacing)；僅用於一個終端剛剛收到
							壞幀或未知幀後報告問題。

					服務質量的深入擴展是TXOP傳輸機會(transmission opporttunity)概念，傳輸機會允許每個終端得到等
				量的通話時間，而不是相同數量的幀。於是可以消除以幀數量來調度方來帶來的低速率拖累高速率的問題。

		-----------

		802.11幀結構:

			802.11標準定義了空中三種不同類型的幀:數據幀，控制幀。管理幀。每種幀都有一個頭，包含了與MAC子層相關
		的各種字段。

			數據幀:

			bytes
				2	2		6		6	6	2	0-2312	4
				幀控制	持續時間	目標地址	源地址	地址3	序號	數據	幀檢驗序列
				| |
				| |
				| |------------------------------------------------------------------------------------------------

				協議版本	類型	子類型	去往DS	來自DS 更多段	重傳	電源位	更多數據	受保護	順序

			bit	2		2	4	1	1	1	1	1	1		1	1

			
				幀控制:本身有11個子字段>
					|-字段1:協議版本(Protocol Version)，2比特，這個字段使得可以在同一個蜂窩同時使用不同協議。
					|-字段2:類型(Type)，數據幀|控制幀|管理幀；
					|-字段3:子類型(Subtype)，RTS|CTS；
					|-字段4:去往DS(To DS)，該幀是否發送至AP網絡；
					|-字段5:來自DS(From DS)，該幀是否來自AP網絡；
					|-字段6:更多段(More fragment)，指出之後是否有更多段；
					|-字段7:重傳(Retry)，幀是否是重傳幀；
					|-字段8:電源管理(Power management)，節能模式設置位；
					|-字段9:更多數據(More data)，表明發送方是否還有更多幀需要發送給接收方；
					|-字段10:受保護的(Protected Frame)，標誌該幀的幀體是否已被加密；
					|-字段11:順序(Order)，告知接收方高層希望嚴格按照順序來處理幀序列；

				持續時間:通知本幀和其確認幀將會佔用信道時長，按微秒計時；該字段出現在所有幀中，其他終端利用該信息
				來更新本地NAV記錄；

				目標地址&源地址&地址3:來自AP的幀與發送給AP的幀都具有3個地址，這些地址是標準IEEE802格式；地址3指明
				遠程主機的地址，AP在傳輸途中是作爲中繼站點；
				
				序號:幀編號，可用於檢查重複幀；序號字段16位，4位標識段，12位標識幀，每發出一幀該數字遞增；

				數據:有效載荷，其長度可達2312字節。有效載荷中前面部分字節格式稱爲邏輯鏈路控制(LLC,Logical Link 
				Control)。這個LLC是一個兼容層，用於標識有效載荷由哪個協議處理；

				幀校驗序列:Frame check sequence.同32位CRC。


				管理幀與數據幀格式相同，其數據部分的格式因子類型的不同而改變。

				控制幀要短一些，也擁有Frame control,Duration,Frame check sequence字段。但是只有一個地址且沒有數據
			部分。大多數關鍵信息轉換爲Subtype字段。

		-----------

		服務:

				服務分組:

					1>關聯:Association.用於終端將自己關聯到AP。來自移動終端的關聯請求，AP可以接受或拒絕；

					2>重新關聯:Reassociation.允許終端改變首選AP。一般用於切換AP；

					3>認證:Authentication.終端與AP關聯後需要使用AP則要向AP認證(除非是開放網絡)。認證方式有:
					WiFi保護接入2(WPA2,WiFi Protected Access 2)，它實現了802.11i標準定義的安全性(802.11i的一
					個子集)。認證方式採用"質詢-迴應(challenge and reponse"。WPA之前使用的模式被稱爲有線等效
					保密(WEP,Wired Equivalent Privacy)；

					4>分發:Distribution.在幀到達AP後，分發服務決定如何路由幀。若是本地地址則直接廣播至空中，
					若是外部則使用集成(Integration)服務來處理協議轉換；

					5>數據傳送:Data delivery.用於在協議上進行數據傳輸；

					6>隱私:Privacy.允許加密信息。

					7>QoS流量調度:QOS traffic scheduling.使用協議來提供給語音和視頻流量比盡力而爲和背景流量
					更高的優先級。同時還有一個服務爲高層提供計時器同步；

					8>發射功率控制:Transmit power control.爲終端提供了發射功率必須滿足監管限制地信息；

					9>動態頻率選擇:Dynamic frequency selection.提供了避免在5GHz頻段發送所需要的信息，因爲這個
					頻段可能有附近的雷達在用；

---------------------------------------------------------------------------------------------------------------

無線寬帶 802.16:

		802.16標準，全球微波接入互操作性(WiMAX,Worldwide Interoperability for Microwave Access)。

		802.16基礎OFDM與MIMO技術使用無線接入網絡且提供Mbps的連接速度。802.16是一個可管理且可靠的服務，且
	具備對服務質量的良好支持。接近於4G蜂窩網絡(長期演進,LTE,Long Term Evolution)。


		-----------

		802.16體系結構與協議棧:

			體繫結構:

							空中接口		基站
					M1#		|
						----#	|-----#			 |
					M2#		|			 |
						----#	|-----#			|-|
					P1#		|			|-|-------------骨幹網絡
						----#	|-----#			|-|
					P2#		|			|-|
			
			協議棧:

				802.16的流行產品是固定與移動WiMAX。每個產品有不同的物理層，都工作在11GHz以下的
			許可頻率中且使用OFDM。

						
						IP..	..	..			---	上層

						特定服務匯聚子層			---
	
						MAC公共子層				---	數據鏈路層
					
						安全子層				---

					固定WiMAX		移動WiMAX		###	物理層
					OFDM(802.16e)		可擴展OFDM(802.16e)	###
					2003年			2005年

				安全子層涉及隱私以及安全。
				MAC公共子層涉及信道管理。
				特定服務匯聚子層採用其他802協議的邏輯鏈路子層，用於爲網絡層提供接口。

		-----------

		802.16物理層:

			大部分WiMAX都部署在3.5GHz與2.5GHz周圍的許可頻譜。但是爲了解決可用頻譜問題，它支持
		在2GHz--11GHz之間工作。同時還支持不同的信道，例如固定WiMAX使用3.5MHz，移動WiMAX使用1.25MHz--
		20MHz。
			信道複用採用OFDM技術，802.16對OFDM進行了優化設計，因此獲得了許可頻譜和廣域傳輸的最大
		效益。信道分成一個更長符號持續時間的許多子載波，以便忍受無線信號衰減；WiMAX參數大約是802.11參
		數的20倍。
			每個子載波上的符號以QPSK，QAM-16，QAM-64調製方案發送。終端靠近基站時具有較高信噪比，
		則採用QAM-64調製技術，每個符號發送6比特；而遠程終端則使用QPSK調製技術，每個符號攜帶2比特。
			數據首先使用卷積編碼進行糾錯編碼。

			802.16在信道劃分上使用了正交頻分多址(OFDMA,Orthogonal Frequency Division Multiple 
		Access)。該方案可以爲不同的終端分配不同的子載波集，因此可以同時多終端收發。除非具有非對成
		流量，所有站都通常交錯發送和接收；這種方法是時分雙工(TDD,Time Division Duplex)。還有另一種
		頻分雙工(FDD,Frequency Division Duplex)模式，站可以在同一時間發送和接收(在不同的子載波頻率
		上)。一般TDD首選，因爲更靈活。
			
				基站控制着流量圖，它可以根據每個站的需要一個幀一個幀地分配不同地帶寬。
				
	
			時分雙工OFDMA的幀結構:
								保護
				下行鏈路			----	上行鏈路

				P  D	Burst	|Burst			Burst
		前		r  o		|-----					下
		一		e  w		|					一
		幀		a  n		|Burst			Burst		幀
		.		m  l	--------------					.
		.		b  i	U |	Burst					.
		.		l  n	p |				Burst		.
				e  k	l |	
				   m	i |------------
				   a	n |	
				   p 	k |				Ranging
					m |	Burst
					a |
					p |



			基站給不同的固定用戶和移動站發送突發流量，所用的子載波由同時出現的流量圖規定。下行
		鏈路傳輸結束後，加上一段保護時間，有利於站從接收狀態切換到發送狀態。最後站使用上行鏈路向基站
		發送突發流量，所用子載波通過流量圖保留。其中一個上行鏈路突發被保留用作測距(ranging)，這是一個
		過程，新的站使用它調整自己的時間，並向連接的基站請求初始帶寬。

		-----------

		802.16的MAC子層協議:

			802.16的公共子層面向連接，並且支持點對多點傳輸，這意味着一個基站可以和多個用戶站通信。
		基站控制突發(burst)，用來給不同的站傳送信息，MAC子層將自己的幀封裝到這個結構中。爲了減少開銷，
		有幾種不同的選擇；例如單獨傳送或者幀突發。

			上行信道的分配方案與服務質量有緊密關係，且上行鏈路信道會被多個接入用戶競爭。
			服務分爲4類:

				1>恆定比特率服務；
				2>實時可變比特率服務；
				3>非實時可變比特率服務；
				4>盡力而爲服務；

			802.16面向連接，服務類型在連接建立時確定。

				恆定比特率服務:目標是傳輸未經壓縮的語音信號。這個服務將會給使用這個類型的連接
				分配特定的"突發"。

				實時可變比特率服務:目標是傳輸未被壓縮的多媒體，或其他軟實時應用。802.16提供這
				個服務的方法是基站以一定週期輪詢用戶，詢問它每次傳輸需要多少帶寬。

				非實時可變比特服務:目標是非實時但繁重的傳輸任務，例如大文件傳輸。這種服務，基
				站需要經常輪詢用戶，但沒有嚴格時間間隔。這種服務的連接也可以使用盡力而爲服務來
				請求帶寬。

				盡力而爲服務:用於其他所有應用。沒有詢問，用戶必須與其他盡力而爲的用戶競爭帶寬。
				通過上行鏈路流量圖中的標記爲的"突發"向基站發送帶寬請求；成功則成功信息會被標註
				在下行鏈路流量圖中；失敗則對應用戶必須以後重新請求。爲了避免最低限度的衝突，可
				能會採用二進制指數後退算法。

		-----------

		802.16幀結構:

					
	bit	1	1	6	1	1	2	1	11	16		8			4

		0	EC	Type	| |	CI	EK	| |	Length	ConnectionID	HeaderCRC	Data	CRC

				通用幀
			
	bit	1	1	6	16		16		8

		1	0	Type	所需的字節	ConnectionID	HeaderCRC	

				帶寬請求幀

			
			EC:EC比特指明瞭有效載荷字段是否經過加密；

			Type:Type字段標識了該幀的類型，通常指明是否存在封裝和分段；

			CI:CI比特表明本幀是否包含最後的校驗和；

			EK:EK字段指明瞭所使用的加密密鑰(如果時用了加密)；

			Length:Length字段給出了該幀的總長度，包括頭部；

			ConnectionID:ConnectionID字段指明瞭該幀屬於哪個連接；

			HeaderCRC:HeaderCRC字段是一個僅僅針對頭的校驗和，多項式爲:x^8+x^2+x+1；

			Data:幀的有效載荷部分，可變；

			CRC:CRC字段給出幀的校驗和，該字段時可選的；

			所需字節:所需字節字段用於說明需要多少帶寬來運載數據；
			
---------------------------------------------------------------------------------------------------------------

藍牙:

	--------

	藍牙體繫結構:
			主從結構

			藍牙系統的基本單元是一個微網(piconet)，微網包含一個主節點，以及10米距離之類至多7個活躍的從節點。
			可以使用一個橋接點將多個微網連接起來，該橋接點必須加入多個微網。一組相互連接的微網稱爲一個散網(
		scatternet)。再一個微網中，除了至多7個活躍從節點外，還可以有多達255個駐留節點。

	--------

	藍牙應用:

			藍牙SIG規範給出了藍牙所支持的專門應用以及應用對應的不同協議棧。藍牙的應用稱爲輪廓(profiles)。一
		般從節點爲主節點提供不同的應用服務。

			通用訪問(generic access)輪廓是構建所有其他輪廓的基礎，它提供了一種建立和維護主站與從站之間安全鏈
		路(信道)的方式。其他輪廓定義了對象交流和音視頻傳輸的基礎。實用輪廓(utility)輪廓廣泛用於模擬串行線等功能。

	--------

	藍牙協議棧:

		藍牙協議體系結構:

			
							應用					|--上層
												|
				輪	輪	輪|						|
						  |						|
						  |	射頻通信	...	服務發現	|
						  |						#
						  |		L2CAP				#
			------------------------------------------------------------------------#--數據鏈路層
				廓	廓	廓|			鏈路管理		#
						  |						#
						  |						#
												#
							鏈路控制(基帶)				$
												$--物理層
						無線電						$
												$

				物理無線電層涉及無限傳輸和調製解調；

				鏈路控制層類似MAC子層，但包含物理層元素，涉及主節點如何控制時間槽以及如何將時間槽組成幀；

				鏈路管理器處理設備之間的邏輯信道建立，電源管理，配對和加密以及服務質量；使用了鏈路控制協議；
				一般接口線下面的協議由藍牙芯片實現，接口線上面的協議由藍牙設備實現。

				邏輯鏈路控制適配協議(L2CAP,Logical Link Control Adaptation Protocol)，涉及可靠性與
				幀格式；使用了鏈路控制協議。

				服務發現(service discovery)協議用於在網絡中尋找可用服務；

				射頻通信(RFcomm,Radio Frequency communication)協議模擬PC上的標準串行端口；

				應用層上的應用使用了特定目標的協議棧切片。

	--------

	藍牙無線電層:

			藍牙是低功率系統，距離範圍爲10米，運行在2.4GHz的ISM頻端上。該頻段分成79個信道，每個信道寬
		1MHz，使用跳頻擴展技術方便與其他2.4GHz上的設備共存。每秒1600跳，駐留時間25微秒；微網中所有節點同步
		跳頻，遵循主節點規定的時間槽和僞隨機調頻序列。
			信道有三種調製技術，基本是頻移鍵控每微秒傳輸1比特符號，提供1Mbps帶寬。2.0版本引進增強型數據
		速率，使用相移監控每符號發送2或3個比特，提供2或3 Mbps的帶寬。但是增強型速率只能用在幀的數據部分。

	--------

	藍牙鏈路層:

		鏈路管理協議負責建立邏輯信道。邏輯信道稱爲鏈路，主設備和從設備通過它運載幀，主從設備可以彼此發。
		主從設備之間發現需要配對，舊配對方法是兩個設備必須配置相同的四位個人識別號碼(PIN,Personal Identifi-
	-cation Number)。新的安全簡單配對(secure simple pairing)方法使用戶能夠確認這兩個設備都顯示相同的密碼，或將
	一臺設備上的密碼輸入至另一臺設備上進行識別；但該方法不可以用在無法輸入的設備上。

		配對成功鏈路管理協議就在兩個設備之間建立鏈路通信。
		運載數據的方法由兩種:
	
				1>同步有連接(SCO,Synchronous Connection Oriented)鏈路，主要用於實時數據傳輸；
				一個從節點與主節點之間最多有3條SCO鏈路，每條鏈路可以傳送一個64000bps的PCM音頻信道。

				2>異步無連接(ACL,Asynchronous ConnectionLess)鏈路，用來以數據包方式交換無時間規
				律的數據；ACL流量是盡力而爲類型服務。

		L2CAP層有四個主要功能:

				1>從上層接受高達64KB的數據包並拆分成幀傳輸；另一端上進行重組。

				2>處理多個數據包源的多路複用和分用。
			
				3>負責確定接收的數據包由什麼協議處理。

				4>處理差錯控制和重傳，並強制多個鏈路之間的服務質量要求。

	--------

	藍牙幀格式:

		
		比特	72		54		0-2744

			訪問碼		頭		數據(速率爲1x)

					|
					|
					|
				
				地址	類型 F A S CRC	###重複3次
					
					|
					|
					|
					
			訪問碼		頭	Guard/Sync	數據(速率爲2x或3x)	尾
		
		比特	72		54	16		0-8184			2


		訪問碼--access code.標識主節點；

		頭--Header.包含典型MAC子層字段；

		數據--Data.5個時間槽的傳輸最多可包含2744位，單時間槽的幀的數據字段要減少到240位。如果幀以增強型
		速率發送，數據部分可達2--3倍。

		地址--Addr.標識幀的接收目標，指向某一個活躍設備。

		類型--Type.標識幀類型與糾錯碼類型。ACL,SCO,輪廓或空。

		F--flow.流標誌位，由主節點設置，當它緩衝區滿時設置該標誌來聲明無法繼續接收數據。

		A--Acknowledgement.指明幀中攜帶一個ACK。
	
		S--Sequence.用於幀編號。傳輸協議使用停-等式協議。

		CRC--循環冗餘校驗和.8比特的頭校驗和CRC，整個18位的頭重複了三次而構成54位頭。接收方檢測3份副本，相同
		接收，不同則少數服從多數。

---------------------------------------------------------------------------------------------------------------

RFID:

		無線射頻識別(RFID,Radio Frequency IDentification) 標籤和讀寫器。一般用於電子產品碼(EPC,Electronic 
	Product Code)。第二代EPC Gen2 2008年。


	--------

	EPC Gen2體繫結構:

		它由RFID讀寫器與標籤構成。標籤自身沒有電源，因此無法主動通信；遇到等到讀寫器的載波信號並從中獲取
	能量，之後纔可以與讀寫器通信。

	--------

	EPC Gen2物理層:

		在美國，EPC Gen2使用902--928MHz的無許可ISM頻段。該頻段屬於超高頻(UHF)。讀寫器以至少每400毫秒的速度
	進行跳頻，將信號分散在不同信道上。讀寫器和標籤使用幅移鍵控的調製(ASK)形式進行編碼，它們的工作模式是半雙工。
		
		讀寫器永遠在發送信號，無論是讀寫器還是標籤在通信。讀寫器使用發射信號傳送比特，如果標籤需要與讀寫器
	通信，讀寫器會發射一個不帶任何比特的載波信號給標籤。標籤收穫該載波能量後可以與讀寫器通信。爲了能夠發送數據，
	標籤必須改變信號，或者將來自讀寫器的信號發射回去。	------	後向散射(backscatter) 它是一種低能量的方式。

		使用簡單的調製解調技術。讀寫器使用2個振幅，0或1的確定取決於讀寫器在低功耗時期之前等待的時間長短。
	標籤測量兩次低功耗時期的時間，並將這段時間與前導碼期間測得的參考值比較，以此確定比特0或1。

	--------

	EPC Gen2標籤標識層:

		標籤之間的多路訪問工作方式是:在第一個時間槽，讀寫器發送Query消息啓動進程，而每個QRepeat消息前進到下
	一個時間槽，並且讀寫器會告知標籤關於時間槽的範圍。標籤在這個時間槽內隨機傳輸。標籤隨機選擇一個時間槽來應答，
	然而標籤未在第一次應答中發送自身標識，而是發送一個RN16消息(16位隨機數)給讀寫器；如果沒有衝突，讀寫器會返回
	ACK。此時標籤已獲得時間槽並發送其EPC標示符。	---	使用這種方式是因爲EPC標示符很長；

		讀寫器在檢測到太多時間槽沒有任何響應或者大量衝突，可以發送QAdjust消息來減少或增加時間槽範圍，即標籤響應
	隨機選擇的後退時間槽數目。

	--------

	標籤標識消息格式:

		比特	4		1	2	1	2	2		1		4	5

			Command		DR	M	TR	Sel	Session		Target		Q	CRC
			1000

	
			Command:攜帶代碼1000用來標識該消息是Query。

			DR&M&TR:確定讀寫器傳輸和標籤響應的物理層參數。

			Sel&Session&Target:選擇標籤作出迴應。除讀寫器要求一個標籤子集回複外，標籤最多可跟蹤四個
			併發會話並得知是否在這些會話中被識別。

			Q:命令參數。該字段定義標籤的響應範圍，0--2^(Q-1)。

			CRC:5位校驗和。

		
			EPC Gen2體繫結構中，讀寫器完全控制傳輸。

---------------------------------------------------------------------------------------------------------------

數據鏈路層交換:

		網橋/交換機:

			網橋(bridge)，它是交換機的舊稱。它自身擁有內存，並且含有高速背板；在需要轉發幀時只是簡單
		地將幀轉發到合適地出境端口。每個端口有單獨衝突域，並且擁有緩衝隊列。一般物理網橋保證了即插即用，在
		首次接入網絡中，它並不知道網絡中各個主機之間地地址。於是在每次收到未知地址地幀時，將使用泛洪算法(
		flooding algorithm)將幀轉發到除入境端口之外地所有端口，隨着時間推移可以慢慢得知各個目標地址對應的
		端口並且會記錄在內部的哈希表中。內部哈希表記錄了各個地址對應的端口。這種學習方法稱爲後向學習法(
		backward learning)。得知幀的轉發端口後可以只需幾微秒完成轉發，這種方式稱爲直通式交換(cut-through 
		switching)或者蟲孔路由(wormhole routing)。
			網橋工作在數據鏈路層，負責幀的轉發。收到入境幀後將其交給中繼(relay)模塊來轉發到對應端口上。

		生成樹網橋:

			在多個網橋連接起來的大型局域網中，可能會有冗餘連接，因此可能造成網絡環路。於是網絡中的網橋
		可以運行一個分佈式算法，網橋週期性地從它的所有端口廣播一個配置消息給鄰居，同時處理來自其他網橋的信
		息。這些信息不轉發，而是用在算法上來構建樹，這顆樹將被用於後續轉發。它們會選擇一個合適的網橋作爲
		生成樹的根，每個網橋在配置信息中加入自身任何合適的網橋標示符(標示符是MAC地址)。之後選擇具有最低地址
		的網橋作爲根，以這個根構建一顆生成樹。構造從根到每個網橋具有最短路徑，並且會裁剪掉冗餘路徑。在生成樹
		構建後該算法也要週期執行以便更新網絡拓撲。

		中繼線/集線器:工作在物理層，中繼線會接收-放大-轉發信號。集線器也類似中繼線，且所有用戶共享帶寬。

		路由器:工作在網絡層，負責IP數據包的路由。自身也擁有內存，且也有數據包排隊機制以及擁塞控制機制。

		虛擬局域網:
			虛擬LAN(VLAN,Virtual LAN)，由IEEE802標準化爲802.1Q。VLAN基於VLAN感知交換機。VLAN使用標識符來標識LAN
		中主機，一般使用顏色來標識。它可以將相同標誌的主機劃分到一個集合中，並且把信息存儲在內部表項中。之後
		VLAN感知交換機可以根據這些標識來轉發幀，若多個VLAN連接在一起。比如VLAN1與VLAN2鏈接，VLAN2中一個網橋
		是VLAN3的入口，於是VLAN1中的網關在不知道VLAN3的情況時會先泛洪，之後得到正確地址後再記錄進入表項中。
		例如將VLAN3與VLAN2關連，之後VLAN3的幀都發往VLAN2。

		IEEE802.1Q標準:

			新的格式的VLAN標準，修改了幀的格式，其中加入了VLAN標籤且可以兼容以太網絡。新的以太網卡與802.1Q
		兼容，且能正確地填寫VLAN字段。
			新的幀的長度限制從1518字節提高到了1522字節，只有VLAN感知的計算機和網橋必須支持這些長度的幀。

			802.1Q幀格式:

				802.3	目標地址	源地址	長度		數據	填充	校驗和

				802.1Q	目標地址	源地址	VLAN	標籤	長度	數據	填充	校驗和
								協議	|
								ID-	|
								0x8100	|
									|		

									優先級	CFI	VLAN標識符

				前面的源地址和目標地址一樣，VLAN協議ID字段總是0x8100，因爲大於1500，所以所有以太網卡會
		將該值解釋爲類型；
				標籤字段含有三個子字段:

					優先級指出幀的服務等級
					CFI是規範格式指示器(CFI,Canonical Format Indicator)，應稱爲企業自我指示器
					(CEI,Corporate Ego Indicator)。最初意圖是指明MAC地址中比特的次序。
					VLAN標識符字段佔用低12位。

				802.1Q幀到達VLAN感知交換機將使用VLAN標識符進行轉發，相關標識符記錄再內部表中。表
			可以由網橋自動配置，也可以手動配置。802.1Q標準說明了如何動態地建立這張標，其中主要引用了
			再802.1D標準中的恰當部分。

---------------------------------------------------------------------------------------------------------------

